@using System.Security.Claims;
@using Microsoft.AspNetCore.Authentication;
@using Microsoft.AspNetCore.Authentication.Cookies;
@inject IHttpContextAccessor httpContextAccessor

@code {
    [Parameter] public List<string> AllowedRoles { get; set; } = null;
    [Inject] private NavigationManager navigation { get; set; } = null!;

    protected override Task OnParametersSetAsync()
    {
        return base.OnParametersSetAsync();
    }
    protected override async Task OnInitializedAsync()
    {
        // Check if user has any roles in the AllowedRoles array
        bool hasPermissions = false;
        foreach (string allowedRole in AllowedRoles)
        {
            if (httpContextAccessor.HttpContext.User.HasClaim(c=>c.Type == "Admin-" + allowedRole))
                hasPermissions = true;
        }

        if (!hasPermissions)
            navigation.NavigateTo("/admin");

        await base.OnInitializedAsync();
    }
}
