CREATE TABLE WRUSER.WRUser (
	WRUserId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	FirstName VARCHAR2(50) NULL,
	LastName VARCHAR2(50) NULL,
	EmailAddress VARCHAR2(255) NULL,
	CTEPUserId VARCHAR2(100) NULL,
	Title VARCHAR2(50) NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	Password VARCHAR2(128) NULL,
	PasswordSalt VARCHAR2(255) NULL,
	IsActive CHAR(1) NOT NULL,
	IsLockedOut CHAR(1) NOT NULL,
	LastLoginDate TIMESTAMP NULL,
	LastPasswordChangedDate TIMESTAMP NULL,
	FailedPasswordAttemptDate TIMESTAMP NULL,
	FailedPasswordAttemptCount NUMBER NULL,
	LoginSourceId NUMBER NULL,
	PRIMARY KEY(UserId)
	);

CREATE TABLE WRUSER.WRUserRequest (
	WRUserRequestId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	RequestId RAW(16) DEFAULT SYS_GUID() NOT NULL,
	IsNewUserRequest CHAR(1) NOT NULL,
	PasswordResetDate TIMESTAMP NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(WRUserRequestId),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId)
	);

CREATE TABLE WRUSER.WRPassword_History (
	WRPasswordHistoryId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	Password VARCHAR2(128) NOT NULL,
	PasswordSalt VARCHAR2(255) NOT NULL,
	CreateDate TIMESTAMP NULL,
	PRIMARY KEY(WRPasswordHistoryId),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId)
	);

CREATE TABLE WRUSER.WRUser_Activity_Log (
	WRUserActivityLogId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	EmailAddress VARCHAR2(255) NULL,
	FirstName VARCHAR2(50) NULL,
	LastName VARCHAR2(50) NULL,
	IsCTEPUser CHAR(1) NOT NULL,
	CTEPUserId VARCHAR2(100) NULL,
	ActivityDate TIMESTAMP NOT NULL,
	ActivityType VARCHAR2(50) NOT NULL,
	PRIMARY KEY(WRUserActivityLogId)
	);

--please note: PRID is not a foreign key here
CREATE TABLE WRUSER.WRRECENT_PROTOCOL_LOG (
	WRRECENT_PROTOCOL_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
	USERID NUMBER NOT NULL,
	PRID NUMBER NOT NULL,
	VIEW_TIME TIMESTAMP NOT NULL,
	PRIMARY KEY(WRRECENT_PROTOCOL_ID)
);

--created, but STUDYID needs to be a foreign key but we don't have access yet
CREATE TABLE WRUSER.WRUSER_PROTOCOL (
	WRUSER_PROTOCOL_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
	USERID NUMBER NOT NULL,
	STUDYID VARCHAR2(40) NOT NULL,
	EXPIRATION_DATE TIMESTAMP NULL,
	CREATE_DATE TIMESTAMP NULL,
	UPDATE_DATE TIMESTAMP NULL,
	PRIMARY KEY(WRUSER_PROTOCOL_ID),
	FOREIGN KEY(USERID) REFERENCES WRUSER.WRUSER(USERID),
	FOREIGN KEY(STUDYID) REFERENCES WRDB.PROTOCOL(STUDYID)
);

CREATE TABLE WRUSER.WRGROUP (
	GroupId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Group_Name VARCHAR2(50) NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	PRIMARY KEY(GroupId)
);

CREATE TABLE WRUSER.WRUser_Group (
	WRUser_Group_Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	GroupId NUMBER NOT NULL,
	Expiration_Date TIMESTAMP NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	PRIMARY KEY(WRUser_Group_Id),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId),
	FOREIGN KEY(GroupId) REFERENCES WRUSER.WRGroup(GroupId)
);


--created, needs foreign key added to protocol
CREATE TABLE WRUSER.WRGroup_Protocol (
	WRGroup_Protocol_Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
	GroupId NUMBER NOT NULL,
	StudyId NUMBER NOT NULL,
	IsActive CHAR(1) NOT NULL,
	PRIMARY KEY(WRGroup_Protocol_Id),
	FOREIGN KEY(GroupId) REFERENCES WRUSER.WRGroup(GroupId)
	FOREIGN KEY(PRID) REFERENCES WRUSER.Protcol(PRID)
);

--created, needs Institution foreign key
CREATE TABLE WRUSER.WRGroupSite (
	WRGroupSiteId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	GroupId NUMBER NOT NULL,
	SiteId NUMBER NOT NULL,
	IsActive CHAR(1) NOT NULL,
	PRIMARY KEY(WRGroupSiteId),
	FOREIGN KEY(GroupId) REFERENCES WRUSER.WRGroup(GroupId),
	FOREIGN KEY(SiteId) REFERENCES WRDB.Insititution(SiteId)
);
--not created
--this is probably going to change
CREATE TABLE WRUSER.ProtocolSite (
	ProtocolSiteId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	PRID NUMBER NOT NULL,
	SiteId NUMBER NOT NULL,
	IsActive CHAR(1) NOT NULL,
	PRIMARY KEY(ProtocolPatientSiteId),
	FOREIGN KEY(PRID) REFERENCES WRUSER.Protcol(PRID),
	FOREIGN KEY(SiteId) REFERENCES WRUSER.Site(SiteId)
);

CREATE TABLE WRUSER.WRUser_Role (
	WRUser_Role_Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	RoleId NUMBER NOT NULL,
	is_Admin CHAR(1) NOT NULL,
	Expiration_Date TIMESTAMP NULL,
	Create_Date TIMESTAMP NULL,
	UPDATE_DATE TIMESTAMP NULL,
	PRIMARY KEY(WRUser_Role_Id),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId),
	FOREIGN KEY(RoleId) REFERENCES WRUSER.WRRole(RoleId)
);

CREATE TABLE WRUSER.WRRole (
	RoleId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Role_Name VARCHAR2(50) NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	PRIMARY KEY(RoleId)
);

CREATE TABLE WRUSER.WRVisual (
	WRVisualId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Visual_Name VARCHAR2(50) NOT NULL,
	Visual_Description VARCHAR2(250) NULL,
	Report_Id NUMBER NOT NULL,
	Page_Name VARCHAR2(250) NOT NULL,
	PowerBI_Visual_Id VARCHAR2(50) NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	PRIMARY KEY(WRVisualId)
);

CREATE TABLE WRUSER.WRRole_Visual (
	WRRole_Visual_Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
	RoleId NUMBER NOT NULL,
	VisualId NUMBER NOT NULL,
	Create_Date TIMESTAMP NULL,
	UPDATE_DATE TIMESTAMP NULL,
	PRIMARY KEY(WRRole_Visual_Id),
	FOREIGN KEY(RoleId) REFERENCES WRUSER.WRRole(RoleId),
	FOREIGN KEY(VisualId) REFERENCES WRUSER.WRVisual(WRVisualId)
	);

CREATE TABLE WRUSER.WRReport_Visual (
	WRReport_Visual_Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
	ReportId NUMBER NOT NULL,
	VisualId NUMBER NOT NULL,
	Display_Order NUMBER NOT NULL,
	PRIMARY KEY(WRReport_Visual_Id),
	FOREIGN KEY(ReportId) REFERENCES WRUSER.WRReport(WRReportId),
	FOREIGN KEY(VisualId) REFERENCES WRUSER.WRVisual(WRVisualId)
);

CREATE TABLE WRUSER.WRReport (
	WRReportId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Name VARCHAR2(50) NOT NULL,
	Description VARCHAR2(250) NULL,
	PowerBI_Report_Id VARCHAR2(100) NOT NULL,
	PageName NUMBER NOT NULL,
	DashboardId NUMBER NOT NULL,
	Display_Order NUMBER NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	PRIMARY KEY(WRReportId),
	FOREIGN KEY(DashboardId) REFERENCES WRUSER.WRDashboard(WRDashboardId)
);

CREATE TABLE WRUSER.WRCustomDashboardCategory (
	WRDashboardCategoryId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Name VARCHAR2(50) NOT NULL,
	Description VARCHAR2(250) NULL,
	DashboardId NUMBER NOT NULL,
	DisplayOrder NUMBER NOT NULL,
	UserId NUMBER NOT NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(WRDashboardCategoryId),
	FOREIGN KEY(DashboardId) REFERENCES WRUSER.WRDashboard(DashboardId)
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId)
);

CREATE TABLE WRUSER.WRDashboard (
	WRDashboardId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Name VARCHAR2(50) NOT NULL,
	Description VARCHAR2(250) NULL,
	Display_Order NUMBER NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	PRIMARY KEY(WRDashboardId)
);
