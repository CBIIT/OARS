CREATE TABLE WRUSER.WRUSER (	
	USERID NUMBER GENERATED BY DEFAULT AS IDENTITY NOT NULL, 
	FIRSTNAME VARCHAR2(50), 
	LASTNAME VARCHAR2(50), 
	EMAILADDRESS VARCHAR2(255), 
	CTEPUSERID VARCHAR2(100), 
	TITLE VARCHAR2(50), 
	CREATEDATE TIMESTAMP, 
	UPDATEDATE TIMESTAMP, 
	PASSWORD VARCHAR2(128), 
	PASSWORDSALT VARCHAR2(255), 
	ISACTIVE CHAR(1) NOT NULL, 
	ISLOCKEDOUT CHAR(1) NOT NULL, 
	LASTLOGINDATE TIMESTAMP, 
	LASTPASSWORDCHANGEDDATE TIMESTAMP, 
	FAILEDPASSWORDATTEMPTDATE TIMESTAMP, 
	FAILEDPASSWORDATTEMPTCOUNT NUMBER, 
	LOGINSOURCEID NUMBER, 
	CURRENTSTUDY VARCHAR2(4000),
	ISCTEPUSER CHAR(1) NOT NULL,
	TIMEZONEABBREVIATION VARCHAR(20),
	TIMEOFFSET NUMBER,
	PRIMARY KEY (USERID)
	);

CREATE TABLE WRUSER.WRUserRequest (
	WRUserRequestId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	RequestId RAW(16) DEFAULT SYS_GUID() NOT NULL,
	IsNewUserRequest CHAR(1) NOT NULL,
	PasswordResetDate TIMESTAMP NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(WRUserRequestId),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId)
	);

CREATE TABLE WRUSER.WRPassword_History (
	WRPasswordHistoryId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	Password VARCHAR2(128) NOT NULL,
	PasswordSalt VARCHAR2(255) NOT NULL,
	CreateDate TIMESTAMP NULL,
	PRIMARY KEY(WRPasswordHistoryId),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId)
	);

  CREATE TABLE "WRUSER"."WRUSER_ACTIVITY_LOG" 
   (	"WRUSER_ACTIVITYLOG_ID" NUMBER GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"USERID" NUMBER NOT NULL ENABLE, 
	"ACTIVITYDATE" TIMESTAMP (6) NOT NULL ENABLE, 
	"ACTIVITYTYPE" VARCHAR2(50 BYTE) NOT NULL ENABLE, 
	"DATA1" VARCHAR2(4000 BYTE), 
	"DATA2" VARCHAR2(4000 BYTE), 
	 CONSTRAINT "SYS_C008942" PRIMARY KEY ("WRUSER_ACTIVITYLOG_ID", "ACTIVITYTYPE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CDR_DATA"  ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CDR_DATA"   NO INMEMORY ;
  
  CREATE TABLE WRUSER.WRUSER_PROTOCOL (
	WRUSER_PROTOCOL_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
	USERID NUMBER NOT NULL,
	STUDYID VARCHAR2(40) NOT NULL,
	EXPIRATION_DATE TIMESTAMP NULL,
	CREATE_DATE TIMESTAMP NULL,
	UPDATE_DATE TIMESTAMP NULL,
	PRIMARY KEY(WRUSER_PROTOCOL_ID),
	FOREIGN KEY(USERID) REFERENCES WRUSER.WRUSER(USERID),
	FOREIGN KEY(STUDYID) REFERENCES WRDB.PROTOCOL(STUDYID)
);

CREATE TABLE WRUSER.WRGROUP (
	GroupId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Group_Name VARCHAR2(50) NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	PRIMARY KEY(GroupId)
);

CREATE TABLE WRUSER.WRUser_Group (
	WRUser_Group_Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	GroupId NUMBER NOT NULL,
	Expiration_Date TIMESTAMP NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	PRIMARY KEY(WRUser_Group_Id),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId),
	FOREIGN KEY(GroupId) REFERENCES WRUSER.WRGroup(GroupId)
);


CREATE TABLE WRUSER.WRGroup_Protocol (
	WRGroup_Protocol_Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
	GroupId NUMBER NOT NULL,
	StudyId VARCHAR2(40) NOT NULL,
	IsActive CHAR(1) NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	PRIMARY KEY(WRGroup_Protocol_Id),
	FOREIGN KEY(GroupId) REFERENCES WRUSER.WRGroup(GroupId)
	FOREIGN KEY(StudyId) REFERENCES WRUSER.Protcol(StudyId)
);

CREATE TABLE WRUSER.WRGroup_Site (
	WR_Group_Site_Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
	GroupId NUMBER NOT NULL,
	SiteId VARCHAR2(200) NOT NULL,
	IsActive CHAR(1) NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	PRIMARY KEY(WRGroup_Site_Id),
	FOREIGN KEY(GroupId) REFERENCES WRUSER.WRGroup(GroupId),
	FOREIGN KEY(SiteId) REFERENCES WRDB.Insititution(INS_RECORD_ID)
);

CREATE TABLE WRUSER.WRProtocol_Site (
	WRProtocol_Site_Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
	StudyId VARCHAR2(40) NOT NULL,
	SiteId VARCHAR2(200) NOT NULL,
	IsActive CHAR(1) NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	PRIMARY KEY(WRProtocol_Site_Id),
	FOREIGN KEY(SiteId) REFERENCES WRDB.INSTITUTION(INS_RECORD_ID),
	FOREIGN KEY(STUDYID) REFERENCES WRUSER.PROTOCOL(STUDYID)
);

CREATE TABLE WRUSER.WRUser_Role (
	WRUser_Role_Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	RoleId NUMBER NOT NULL,
	Expiration_Date TIMESTAMP NULL,
	Create_Date TIMESTAMP NULL,
	UPDATE_DATE TIMESTAMP NULL,
	PRIMARY KEY(WRUser_Role_Id),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId),
	FOREIGN KEY(RoleId) REFERENCES WRUSER.WRRole(RoleId)
);

CREATE TABLE WRUSER.WRRole (
	RoleId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Role_Name VARCHAR2(50) NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	AdminType VARCHAR2(10 BYTE) NOT NULL ENABLE,
	Is_Primary CHAR(1 BYTE) NOT NULL ENABLE,
	PRIMARY KEY(RoleId)
);

CREATE TABLE WRUSER.WRVisual (
	WRVisualId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Visual_Name VARCHAR2(50) NOT NULL,
	Visual_Description VARCHAR2(250) NULL,
	Report_Id NUMBER NOT NULL,
	Page_Name VARCHAR2(250) NOT NULL,
	PowerBI_Visual_Id VARCHAR2(50) NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	VISUAL_TYPE VARCHAR2(50),
	DISPLAY_ORDER NUMBER,
	PRIMARY KEY(WRVisualId)
);

CREATE TABLE WRUSER.WRRole_Visual (
	WRRole_Visual_Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
	RoleId NUMBER NOT NULL,
	VisualId NUMBER NOT NULL,
	Create_Date TIMESTAMP NULL,
	UPDATE_DATE TIMESTAMP NULL,
	PRIMARY KEY(WRRole_Visual_Id),
	FOREIGN KEY(RoleId) REFERENCES WRUSER.WRRole(RoleId),
	FOREIGN KEY(VisualId) REFERENCES WRUSER.WRVisual(WRVisualId)
	);

CREATE TABLE WRUSER.WRReport (
	WRReportId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Name VARCHAR2(50) NOT NULL,
	Description VARCHAR2(250) NULL,
	DashboardId NUMBER NOT NULL,
	Display_Order NUMBER NOT NULL,
	Display_Icon_Name VARCHAR2(250) NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL,
	Is_Full_Page CHAR(1) NOT NULL,
	PowerBI_Page_Name VARCHAR2(100),
	Custom_Page_Path VARCHAR2(1000),
	StudyType VARCHAR2(50),
	POWERBI_REPORT_ID VARCHAR2(100),
	PageName VARCHAR2(100),
	ReportName VARCHAR2(100),
	FilterType VARCHAR2(50),
	PRIMARY KEY(WRReportId),
	FOREIGN KEY(DashboardId) REFERENCES WRUSER.WRDashboard(WRDashboardId)
);

--CREATE TABLE WRUSER.WRCustomDashboardCategory (
--	WRDashboardCategoryId NUMBER GENERATED BY DEFAULT AS IDENTITY,
--	Name VARCHAR2(50) NOT NULL,
--	Description VARCHAR2(250) NULL,
--	DashboardId NUMBER NOT NULL,
--	DisplayOrder NUMBER NOT NULL,
--	UserId NUMBER NOT NULL,
--	CreateDate TIMESTAMP NULL,
--	UpdateDate TIMESTAMP NULL,
--	PRIMARY KEY(WRDashboardCategoryId),
--	FOREIGN KEY(DashboardId) REFERENCES WRUSER.WRDashboard(DashboardId)
--	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId)
--);

CREATE TABLE WRUSER.WRDashboard (
	WRDashboardId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Name VARCHAR2(50) NOT NULL,
	Description VARCHAR2(250) NULL,
	Display_Order NUMBER NOT NULL,
	Create_Date TIMESTAMP NULL,
	Update_Date TIMESTAMP NULL, 
	Custom_Page_Path VARCHAR2(1000) NULL,
	PowerBI_Report_ID VARCHAR2(100) NULL,
	PRIMARY KEY(WRDashboardId)
);

CREATE TABLE WRUSER.WRNOTIFICATIONS (
	WRNOTIFICATIONID NUMBER GENERATED BY DEFAULT AS IDENTITY,
	NOTIFICATION_TYPE VARCHAR2(50) NOT NULL,
	DASHBOARDID NUMBER NULL,
	ISPUBLIC NUMBER NOT NULL,
	START_DATE TIMESTAMP NOT NULL,
	END_DATE TIMESTAMP NOT NULL,
	USERID NUMBER NULL,
	PRIMARY KEY(WRNOTIFICATIONID),
	FOREIGN KEY(DASHBOARDID) REFERENCES WRUSER.WRDashboard(WRDashboardId)
);


CREATE TABLE WRUSER.WRALERT ( 
	WRALERTID NUMBER GENERATED ALWAYS AS IDENTITY ( START WITH 101 MAXVALUE 9999999999999999999999999999 MINVALUE 1 CYCLE CACHE 20 ORDER KEEP NOSCALE) NOT NULL, 
	PAGENAME VARCHAR2(50 BYTE) NULL, 
	DASHBOARDID NUMBER NULL, 
	ALERTTYPE VARCHAR2(20 BYTE) NULL, 
	ALERTTEXT VARCHAR2(4000 BYTE) NULL, 
	ISACTIVE CHAR(1 BYTE) NOT NULL, 
	CREATEDATE TIMESTAMP(6) NULL, 
	UPDATEDATE TIMESTAMP(6) NULL, 
	STARTDATE TIMESTAMP(6) NULL, 
	ENDDATE TIMESTAMP(6) NULL 
);

CREATE TABLE "WRUSER"."WRROLE_DASHBOARD" 
   (	"WRROLE_DASHBOARD_ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 ORDER  CYCLE  KEEP  NOSCALE  NOT NULL ENABLE, 
	"ROLEID" NUMBER NOT NULL ENABLE, 
	"DASHBOARDID" NUMBER NOT NULL ENABLE, 
	"CREATE_DATE" TIMESTAMP (6), 
	"UPDATE_DATE" TIMESTAMP (6), 
	 CONSTRAINT "WRROLE_DASHBOARD_PK" PRIMARY KEY ("WRROLE_DASHBOARD_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CDR_DATA"  ENABLE, 
	 CONSTRAINT "FK_ROLEID" FOREIGN KEY ("ROLEID")
	  REFERENCES "WRUSER"."WRROLE" ("ROLEID") ENABLE, 
	 CONSTRAINT "FK_DASHBOARDID" FOREIGN KEY ("DASHBOARDID")
	  REFERENCES "WRUSER"."WRDASHBOARD" ("WRDASHBOARDID") ENABLE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "CDR_DATA"   NO INMEMORY ;

CREATE TABLE WRUSER.WRROLE_REPORT
(
  WRROLE_REPORT_ID  NUMBER GENERATED ALWAYS AS IDENTITY ( START WITH 1 MAXVALUE 9999999999999999999999999999 MINVALUE 1 CYCLE CACHE 20 ORDER KEEP NOSCALE) NOT NULL,
  ROLEID            NUMBER                      NOT NULL,
  REPORTID          NUMBER                      NOT NULL,
  CREATE_DATE       TIMESTAMP(6)                    NULL,
  UPDATE_DATE       TIMESTAMP(6)                    NULL
)
TABLESPACE CDR_DATA
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE;

CREATE TABLE "WRUSER"."WRUSER_PROTOCOLHISTORY" 
   (	"WRUSER_PROTOCOLHISTORY_ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"USERID" NUMBER NOT NULL ENABLE, 
	"STUDYID" VARCHAR2(20 BYTE), 
	"CREATEDATE" TIMESTAMP (6), 
	 CONSTRAINT "WRUSER_PROTOCOLHISTORY_PK" PRIMARY KEY ("WRUSER_PROTOCOLHISTORY_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  TABLESPACE "CDR_DATA"  ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "CDR_DATA"   NO INMEMORY ;
