@page "/"
@page "/landing"
@page "/login"
@using TheradexPortal.Data.Models;
@using TheradexPortal.Data.Services;
@using TheradexPortal.Data;
@using TheradexPortal.Data.Services.Abstract;
@layout LoginLayout

<Container Position="Position.Absolute.Top.Is50.Start.Is50.Translate.Middle">
    <Row>
        <Column ColumnSize="ColumnSize.Is4.Is4.WithOffset">
            <Card>
                <CardBody>
                    <CardTitle Size="5">
                        Web Reporting 3.0
                    </CardTitle>
                </CardBody>
                <CardBody>
                    <Div Class="my-2" Flex="Flex.JustifyContent.Center">
                        <!--Button Flex="Flex.JustifyContent.Center" Block Color="Color.Secondary" Type="ButtonType.Link" To="/Login/Login">Theradex Sign In</!--Button-->
                        <Button Flex="Flex.JustifyContent.Center" Block Color="Color.Primary" TextColor="TextColor.White" Clicked="@OnButtonClicked">Theradex Sign In</Button>
                    </Div>
                    <Div Class="my-2" Flex="Flex.JustifyContent.Center">
                        <Button Flex="Flex.JustifyContent.Center" Block Color="Color.Primary" TextColor="TextColor.White" Clicked="@OnSAMLButtonClicked">CTEP/NIH Sign In</Button>
                    </Div>
                </CardBody>
            </Card>
            <br />
        </Column>
        <Column ColumnSize="ColumnSize.Is4.Is4.WithOffset">
            <Card>
                <CardBody>
                    <CardTitle Size="6">
                        Alerts
                    </CardTitle>
                    @foreach (var alert in activeAlerts)
                    {
                        <Alert Color="Color.Warning" Visible>
                            <AlertMessage>Title</AlertMessage>
                            <AlertDescription>@alert.AlertText</AlertDescription>
                        </Alert>
                    }
                </CardBody>
            </Card>
            <br />
            <Card>
                <CardBody>
                    <CardTitle Size="6">
                        Notes and Updates
                    </CardTitle>
                    @foreach (var note in activeNotes)
                    {
                        <Alert Color="Color.Info" Visible>
                            <AlertMessage>Title</AlertMessage>
                            <AlertDescription>@note.AlertText</AlertDescription>
                        </Alert>
                    }
                </CardBody>
            </Card>
        </Column>
    </Row>
</Container>

@code {
    [Inject] public NavigationManager Navigation { get; set; }
    [Inject] private IAlertService alertService { get; set; } = null!;
    private IList<WRAlert> activeAlerts = new List<WRAlert>();
    private IList<WRAlert> activeNotes = new List<WRAlert>();

    protected override async Task OnInitializedAsync()
    {
        activeAlerts = await alertService.GetActiveLoginAlertsAsync();
        activeNotes = await alertService.GetActiveLoginNotesAsync();
        await base.OnInitializedAsync();
    }

    Task OnButtonClicked()
    {
        Navigation.NavigateTo($"Login", true);

        return Task.CompletedTask;
    }

    Task OnSAMLButtonClicked()
    {
        Navigation.NavigateTo($"Auth/Login", true);

        return Task.CompletedTask;
    }
}
