@page "/dashboard"
@layout SecondaryNavLayout

@using System.Net.Http
@using System.Threading.Tasks
@using TheradexPortal.Data;
@using TheradexPortal.Data.Models;
@using TheradexPortal.Data.PowerBI;


<LayoutSider>
    <SecondaryNav />
</LayoutSider>
<LayoutContent>
    <Container Fluid Class="mt-2">
        <PowerBiCustomLayout />
    </Container>
</LayoutContent>

<Modal @ref="modalRef">
    <ModalContent Centered Size="ModalSize.ExtraLarge">
        <ModalBody>
            <StudyGrid OnSave="@HideFilters"/>
        </ModalBody>
    </ModalContent>
</Modal>


@code {

    private Modal? modalRef;
    private PowerBiCustomLayout? customReportRef;
    private PowerBiFullReport? fullReportRef;
    private string selectedTab = "studies";

    private Task OnSelectedTabChanged( string name )
    {
        selectedTab = name;
        return Task.CompletedTask;
    }

    private async Task ShowFilters()
    {
        if (modalRef != null)
        {
            await modalRef.Show();
        }
        
    }

    // hide modal
    private async void HideFilters(List<Protocol>? selectedStudies)
    {
        if (selectedTab == "tab1" && customReportRef != null)
        {
            await customReportRef.Update();
        }

        if (selectedTab == "tab2" &&fullReportRef != null)
        {
            await fullReportRef.Update();
        }

        if(modalRef != null)
        {
            await modalRef.Hide();
        }
    }
}