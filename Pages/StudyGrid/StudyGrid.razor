@page "/studygrid"
@using TheradexPortal.Data.Models
@using TheradexPortal.Data

@inject StudyService studyService

<DataGrid TItem="StudyData.Study"
            Data="@studyList"
            @bind-SelectedRow="@selectedStudy"
            SelectionMode="DataGridSelectionMode.Multiple"
            @bind-SelectedRows="selectedStudies"
            Responsive
            RowSelectable = "RowSelectableHandler"
            DetailRowTrigger="@((e) => e.Item.StudyId == selectedStudy?.StudyId)"            
            >
        
        <DataGridMultiSelectColumn Width="30px"> </DataGridMultiSelectColumn>
        <DataGridCommandColumn />
        <DataGridColumn Field="@nameof(StudyData.Study.StudyId)" Caption="Study ID" />
        <DataGridColumn Field="@nameof(StudyData.Study.PrimaryAgent)" Caption="Primary Agent" />
        <DataGridColumn Field="@nameof(StudyData.Study.SecondaryAgent)" Caption="Secondary Agent" />
        <DataGridColumn Field="@nameof(StudyData.Study.Other)" Caption="Other" />
        <DataGridColumn Field="@nameof(StudyData.Study.Title)" Caption="Title" />
        
        @*<DetailRowTemplate>
            @{
                var study_detail = (context as StudyData.Study);

                <DataGrid TItem="study_detail"
                            Data="@studyList"
                            Sortable="false"
                >
                    <DataGridColumn Field="@nameof(Study.ProtocolTitle)" Caption="Protocol Title" />
                    <DataGridColumn Field="@nameof(Study.ProtocolStatus)" Caption="Protocol Status" />
                    <DataGridColumn Field="@nameof(Study.PrimaryInvestigator)" Caption="Primary Investigator" />
                    <DataGridColumn Field="@nameof(Study.MonitoringMethod)" Caption="Monitoring Method" />
                    <DataGridColumn Field="@nameof(Study.Accrual)" Caption="Accrual" />
                    <DataGridColumn Field="@nameof(Study.DateOfLastEdcUpdate)" Caption="Date of Last EDC Update" />
                    <DataGridColumn Field="@nameof(Study.TotalPatientsInWebReporting)" Caption="Total Patients in Web Reporting" />
                    <DataGridColumn Field="@nameof(Study.RecentEnrollmentInWebReporting)" Caption="Recent Enrollment in Web Reporting" />
                    <DataGridColumn Field="@nameof(Study.SubsequentPhaseActivationDate)" Caption="Subsequent Phase Activation Date" />
                </DataGrid>
            }
        </DetailRowTemplate>*@
</DataGrid>

@code {
    [Inject]

    public StudyData? StudyData { get; set; }
    private List<StudyData.Study>? studyList;
    private StudyData.Study? selectedStudy;
    private List<StudyData.Study>? selectedStudies;

    protected override async Task OnInitializedAsync()
    {
        studyList = await StudyData.GetStudyList();
        await base.OnInitiaizedAsync();
    }

    private bool RowSelectableHandler(RowSelectableEventArgs<StudyData.Study> rowSelectableEventArgs)
    => rowSelectableEventArgs.SelectReason is not DataGridSelectReason.RowClick;

    // checkbox
    // study id
    // primary agent
    // secondary agent
    // other
    // title (study title)
    // Overview
        // Protocol
        // Protocol Title = Protocol.ProtocolTitle
        // Protocol Status = Protocol.ProtocolStatus
        // Primary Investigator = Protocol.PrimaryInvestigator
        // Monitoring Method = Protocol.MonitoringMethod
        // Accrual (Screening/Intervention/Other)
        // Date of Last EDC Update
        // Total Patients in Web Reporting = Protocol.NumberOfPatientEnrolledOnStudy
        // Recent Enrollment in Web Reporting
        // Subsequent Phase Activation Date
}