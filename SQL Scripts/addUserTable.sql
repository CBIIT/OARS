CREATE TABLE WRUSER.WRUser (
	WRUserId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	FirstName VARCHAR2(50) NULL,
	LastName VARCHAR2(50) NULL,
	EmailAddress VARCHAR2(255) NULL,
	CTEPUserId VARCHAR2(100) NULL,
	Title VARCHAR2(50) NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	Password VARCHAR2(128) NULL,
	PasswordSalt VARCHAR2(255) NULL,
	IsActive CHAR(1) NOT NULL,
	IsLockedOut CHAR(1) NOT NULL,
	LastLoginDate TIMESTAMP NULL,
	LastPasswordChangedDate TIMESTAMP NULL,
	FailedPasswordAttemptDate TIMESTAMP NULL,
	FailedPasswordAttemptCount NUMBER NULL,
	LoginSourceId NUMBER NULL,
	PRIMARY KEY(UserId)
	);

CREATE TABLE WRUSER.WRUserRequest (
	WRUserRequestId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	RequestId RAW(16) DEFAULT SYS_GUID() NOT NULL,
	IsNewUserRequest CHAR(1) NOT NULL,
	PasswordResetDate TIMESTAMP NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(WRUserRequestId),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId)
	);

CREATE TABLE WRUSER.WRPassword_History (
	WRPasswordHistoryId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	Password VARCHAR2(128) NOT NULL,
	PasswordSalt VARCHAR2(255) NOT NULL,
	CreateDate TIMESTAMP NULL,
	PRIMARY KEY(WRPasswordHistoryId),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId)
	);

CREATE TABLE WRUSER.WRUser_Activity_Log (
	WRUserActivityLogId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	EmailAddress VARCHAR2(255) NULL,
	FirstName VARCHAR2(50) NULL,
	LastName VARCHAR2(50) NULL,
	IsCTEPUser CHAR(1) NOT NULL,
	CTEPUserId VARCHAR2(100) NULL,
	ActivityDate TIMESTAMP NOT NULL,
	ActivityType VARCHAR2(50) NOT NULL,
	PRIMARY KEY(WRUserActivityLogId)
	);

--please note: PRID is not a foreign key here
CREATE TABLE WRUSER.WRRECENT_PROTOCOL_LOG (
	WRRECENT_PROTOCOL_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
	USERID NUMBER NOT NULL,
	PRID NUMBER NOT NULL,
	VIEW_TIME TIMESTAMP NOT NULL,
	PRIMARY KEY(WRRECENT_PROTOCOL_ID)
);

--not created, STUDYID needs to be a foreign key but we don't have access yet
CREATE TABLE WRUSER.WRUSER_PROTOCOL (
	WRUSER_PROTOCOL_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
	USERID NUMBER NOT NULL,
	STUDYID VARCHAR2(40) NOT NULL,
	EXPIRATION_DATE TIMESTAMP NULL,
	CREATE_DATE TIMESTAMP NULL,
	UPDATE_DATE TIMESTAMP NULL,
	PRIMARY KEY(WRUSER_PROTOCOL_ID),
	FOREIGN KEY(USERID) REFERENCES WRUSER.WRUSER(USERID),
	FOREIGN KEY(STUDYID) REFERENCES WRDB.PROTOCOL(STUDYID)
);

CREATE TABLE WRUSER.WRGroup (
	GroupId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	GroupName VARCHAR2(50) NOT NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(GroupId)
);

CREATE TABLE WRUSER.WRUserGroup (
	WRUserGroupId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	GroupId NUMBER NOT NULL,
	ExpirationDate TIMESTAMP NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(WRUserGroupId),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId),
	FOREIGN KEY(GroupId) REFERENCES WRUSER.WRGroup(GroupId)
);



CREATE TABLE WRUSER.WRGroupProtocol (
	WRGroupProtocolId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	GroupId NUMBER NOT NULL,
	PRID NUMBER NOT NULL,
	IsActive CHAR(1) NOT NULL,
	PRIMARY KEY(WRGroupProtocolId),
	FOREIGN KEY(GroupId) REFERENCES WRUSER.WRGroup(GroupId),
	FOREIGN KEY(PRID) REFERENCES WRUSER.Protcol(PRID)
);

CREATE TABLE WRUSER.WRGroupSite (
	WRGroupSiteId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	GroupId NUMBER NOT NULL,
	SiteId NUMBER NOT NULL,
	IsActive CHAR(1) NOT NULL,
	PRIMARY KEY(WRGroupSiteId),
	FOREIGN KEY(GroupId) REFERENCES WRUSER.WRGroup(GroupId),
	FOREIGN KEY(SiteId) REFERENCES WRUSER.Site(SiteId)
);

CREATE TABLE WRUSER.Site (
	SiteId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	SiteName VARCHAR2(250) NOT NULL,
	SiteAlias VARCHAR2(50) NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(SiteId)
);

--this is probably going to change
CREATE TABLE WRUSER.ProtocolSite (
	ProtocolSiteId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	PRID NUMBER NOT NULL,
	SiteId NUMBER NOT NULL,
	IsActive CHAR(1) NOT NULL,
	PRIMARY KEY(ProtocolPatientSiteId),
	FOREIGN KEY(PRID) REFERENCES WRUSER.Protcol(PRID),
	FOREIGN KEY(SiteId) REFERENCES WRUSER.Site(SiteId)
);

CREATE TABLE WRUSER.WRUserRole (
WRUserRole NUMBER GENERATED BY DEFAULT AS IDENTITY,
	UserId NUMBER NOT NULL,
	RoleId NUMBER NOT NULL,
	ExpirationDate TIMESTAMP NULL,
	CreateDate TIMESTAMP NULL,
	PRIMARY KEY(WRUserRole),
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId),
	FOREIGN KEY(RoleId) REFERENCES WRUSER.WRRole(RoleId)
);

CREATE TABLE WRUSER.WRRole (
	RoleId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	RoleName VARCHAR2(50) NOT NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(RoleId)
);

CREATE TABLE WRUSER.WRRoleVisual (
	WRRoleVisualId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	RoleId NUMBER NOT NULL,
	VisualId NUMBER NOT NULL,
	CreateDate TIMESTAMP NULL,
	PRIMARY KEY(WRRoleVisualId),
	FOREIGN KEY(RoleId) REFERENCES WRUSER.WRRole(RoleId),
	FOREIGN KEY(VisualId) REFERENCES WRUSER.WRVisual(VisualId)
	);

CREATE TABLE WRUSER.WRVisual (
	WRVisualId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	VisualName VARCHAR2(50) NOT NULL,
	VisualDescription VARCHAR2(250) NULL,
	ReportId NUMBER NOT NULL,
	PageName VARCHAR2(250) NOT NULL,
	PowerBIVisualId VARCHAR2(50) NOT NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(VisualId),
);

CREATE TABLE WRUSER.WRDashboardCategoryVisual (
	WRDashboardCategoryVisualId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	DashboardCategoryId NUMBER NOT NULL,
	VisualId NUMBER NOT NULL,
	DisplayOrder NUMBER NOT NULL,
	PRIMARY KEY(WRDashboardCategoryVisualId),
	FOREIGN KEY(DashboardCategoryId) REFERENCES WRUSER.WRDashboardCategory(DashboardCategoryId),
	FOREIGN KEY(VisualId) REFERENCES WRUSER.WRVisual(VisualId)
);

CREATE TABLE WRUSER.WRDashboardCategory (
	WRDashboardCategoryId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Name VARCHAR2(50) NOT NULL,
	Description VARCHAR2(250) NULL,
	DashboardId NUMBER NOT NULL,
	DisplayOrder NUMBER NOT NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(WRDashboardCategoryId),
	FOREIGN KEY(DashboardId) REFERENCES WRUSER.WRDashboard(DashboardId)
);

CREATE TABLE WRUSER.WRCustomDashboardCategory (
	WRDashboardCategoryId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Name VARCHAR2(50) NOT NULL,
	Description VARCHAR2(250) NULL,
	DashboardId NUMBER NOT NULL,
	DisplayOrder NUMBER NOT NULL,
	UserId NUMBER NOT NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(WRDashboardCategoryId),
	FOREIGN KEY(DashboardId) REFERENCES WRUSER.WRDashboard(DashboardId)
	FOREIGN KEY(UserId) REFERENCES WRUSER.WRUser(UserId)
);

CREATE TABLE WRUSER.WRDashboard (
	WRDashboardId NUMBER GENERATED BY DEFAULT AS IDENTITY,
	Name VARCHAR2(50) NOT NULL,
	Description VARCHAR2(250) NULL,
	DisplayOrder NUMBER NOT NULL,
	CreateDate TIMESTAMP NULL,
	UpdateDate TIMESTAMP NULL,
	PRIMARY KEY(WRDashboardId)
);